<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/qinlingrong.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/qinlingrong.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/qinlingrong.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/qinlingrong.github.io/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/qinlingrong.github.io/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/qinlingrong.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/qinlingrong.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="##探究fragment转场动画的执行流程 ###我们都知道fragment可以设置它的转场动画，来实现fragment之间的切换的动画效果。如下代码：12345FragmentManager fragmentManager = getSupportFragmentManager();FragmentTransaction fragmentTransaction = fragmentManager">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://qlrishui.github.io/2018/02/27/探究fragment转场动画的执行流程/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="##探究fragment转场动画的执行流程 ###我们都知道fragment可以设置它的转场动画，来实现fragment之间的切换的动画效果。如下代码：12345FragmentManager fragmentManager = getSupportFragmentManager();FragmentTransaction fragmentTransaction = fragmentManager">
<meta property="og:updated_time" content="2018-02-26T19:59:49.154Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="##探究fragment转场动画的执行流程 ###我们都知道fragment可以设置它的转场动画，来实现fragment之间的切换的动画效果。如下代码：12345FragmentManager fragmentManager = getSupportFragmentManager();FragmentTransaction fragmentTransaction = fragmentManager">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/qinlingrong.github.io/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://qlrishui.github.io/2018/02/27/探究fragment转场动画的执行流程/"/>





  <title> | Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/qinlingrong.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/qinlingrong.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/qinlingrong.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://qlrishui.github.io/qinlingrong.github.io/2018/02/27/探究fragment转场动画的执行流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/qinlingrong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline"></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-27T03:59:44+08:00">
                2018-02-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>##探究fragment转场动画的执行流程</p>
<p>###我们都知道fragment可以设置它的转场动画，来实现fragment之间的切换的动画效果。如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FragmentManager fragmentManager = getSupportFragmentManager();</span><br><span class="line">FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();</span><br><span class="line">fragmentTransaction.setCustomAnimations(R.anim.menushow,R.anim.menuhide);</span><br><span class="line">fragmentTransaction.add(R.id.ad_container,new ClsInfoFragment(),&quot;tag1&quot;);</span><br><span class="line">fragmentTransaction.commitAllowingStateLoss();</span><br></pre></td></tr></table></figure></p>
<p>这样简单几句话就可以实现fragment之间的切换效果动画，那其中都经历了什么，我们来跟踪源码看一看流程是怎么走的。</p>
<p>我们先从setCustomAnimations（int enter, int exit）走起，进入源码可见这是一个抽象方法，属于抽象类FragmentTransaction，需要注意的是，此处的exit动画并不适用于出栈动画，如果你试图在这使用它做一个出栈动画是无效的，出栈动画需要用另一个方法<br>setCustomAnimations(enter, exit, popEnter, popExit),第四个参数才是设置出栈动画</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    /**</span><br><span class="line">     * Set specific animation resources to run for the fragments that are</span><br><span class="line">     * entering and exiting in this transaction. These animations will not be</span><br><span class="line">     * played when popping the back stack.</span><br><span class="line">     *</span><br><span class="line">     * @param enter An animation or animator resource ID used for the enter animation on the</span><br><span class="line">     *              view of the fragment being added or attached.</span><br><span class="line">     * @param exit An animation or animator resource ID used for the exit animation on the</span><br><span class="line">     *             view of the fragment being removed or detached.</span><br><span class="line">     */</span><br><span class="line">    public abstract FragmentTransaction setCustomAnimations(@AnimatorRes @AnimRes int enter,</span><br><span class="line">            @AnimatorRes @AnimRes int exit);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">两个方法的对比            </span><br><span class="line">            </span><br><span class="line">/**</span><br><span class="line">     * Set specific animation resources to run for the fragments that are</span><br><span class="line">     * entering and exiting in this transaction. The &lt;code&gt;popEnter&lt;/code&gt;</span><br><span class="line">     * and &lt;code&gt;popExit&lt;/code&gt; animations will be played for enter/exit</span><br><span class="line">     * operations specifically when popping the back stack.</span><br><span class="line">     *</span><br><span class="line">     * @param enter An animation or animator resource ID used for the enter animation on the</span><br><span class="line">     *              view of the fragment being added or attached.</span><br><span class="line">     * @param exit An animation or animator resource ID used for the exit animation on the</span><br><span class="line">     *             view of the fragment being removed or detached.</span><br><span class="line">     * @param popEnter An animation or animator resource ID used for the enter animation on the</span><br><span class="line">     *                 view of the fragment being readded or reattached caused by</span><br><span class="line">     *                 &#123;@link FragmentManager#popBackStack()&#125; or similar methods.</span><br><span class="line">     * @param popExit An animation or animator resource ID used for the enter animation on the</span><br><span class="line">     *                view of the fragment being removed or detached caused by</span><br><span class="line">     *                &#123;@link FragmentManager#popBackStack()&#125; or similar methods.</span><br><span class="line">     */</span><br><span class="line">    public abstract FragmentTransaction setCustomAnimations(@AnimatorRes @AnimRes int enter,</span><br><span class="line">            @AnimatorRes @AnimRes int exit, @AnimatorRes @AnimRes int popEnter,</span><br><span class="line">            @AnimatorRes @AnimRes int popExit);</span><br></pre></td></tr></table></figure>
<p>因为FragmentTransaction是个抽象类，那么我们找到他的实现类BackStackRecord，位于android.support.v4.app包下。它的setCustomAnimations方法只是简单的将我们传入的参数赋值给自身的变量,并返回自身对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public FragmentTransaction setCustomAnimations(int enter, int exit,</span><br><span class="line">        int popEnter, int popExit) &#123;</span><br><span class="line">    mEnterAnim = enter;</span><br><span class="line">    mExitAnim = exit;</span><br><span class="line">    mPopEnterAnim = popEnter;</span><br><span class="line">    mPopExitAnim = popExit;</span><br><span class="line">    return this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 那我们再来看下一步fragmentTransaction.add(R.id.ad_container,new ClsInfoFragment(),”tag1”)都做了什么。依然还是BackStackRecord类。</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> @Override</span><br><span class="line">public FragmentTransaction add(int containerViewId, Fragment fragment, String tag) &#123;</span><br><span class="line">    doAddOp(containerViewId, fragment, tag, OP_ADD);</span><br><span class="line">    return this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> BackStackRecord里的add方法里调用了一个doAddOp方法，源码如下：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> private void doAddOp(int containerViewId, Fragment fragment, String tag, int opcmd) &#123;</span><br><span class="line">    final Class fragmentClass = fragment.getClass();</span><br><span class="line">    final int modifiers = fragmentClass.getModifiers();</span><br><span class="line">    if (fragmentClass.isAnonymousClass() || !Modifier.isPublic(modifiers)</span><br><span class="line">            || (fragmentClass.isMemberClass() &amp;&amp; !Modifier.isStatic(modifiers))) &#123;</span><br><span class="line">        throw new IllegalStateException(&quot;Fragment &quot; + fragmentClass.getCanonicalName()</span><br><span class="line">                + &quot; must be a public static class to be  properly recreated from&quot;</span><br><span class="line">                + &quot; instance state.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fragment.mFragmentManager = mManager;</span><br><span class="line"></span><br><span class="line">    if (tag != null) &#123;</span><br><span class="line">        if (fragment.mTag != null &amp;&amp; !tag.equals(fragment.mTag)) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Can&apos;t change tag of fragment &quot;</span><br><span class="line">                    + fragment + &quot;: was &quot; + fragment.mTag</span><br><span class="line">                    + &quot; now &quot; + tag);</span><br><span class="line">        &#125;</span><br><span class="line">        fragment.mTag = tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (containerViewId != 0) &#123;</span><br><span class="line">        if (containerViewId == View.NO_ID) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;Can&apos;t add fragment &quot;</span><br><span class="line">                    + fragment + &quot; with tag &quot; + tag + &quot; to container view with no id&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (fragment.mFragmentId != 0 &amp;&amp; fragment.mFragmentId != containerViewId) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Can&apos;t change container ID of fragment &quot;</span><br><span class="line">                    + fragment + &quot;: was &quot; + fragment.mFragmentId</span><br><span class="line">                    + &quot; now &quot; + containerViewId);</span><br><span class="line">        &#125;</span><br><span class="line">        fragment.mContainerId = fragment.mFragmentId = containerViewId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addOp(new Op(opcmd, fragment));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 这里先是将fragment关联到fragmentmanager对象，为fragment设置tag，然后调用一个addOp(new Op(opcmd, fragment))方法，opcmd是上面传入的一个OP_ADD常量，在BackStackRecord中有一系列常量如<code>OP_HIDE</code>，<code>OP_SHOW</code>，<code>OP_DETACH</code>，<code>OP_ATTACH</code>，<code>OP_ADD</code>等等来控制下面的流程走向。让我们进入addOp方法：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> void addOp(Op op) &#123;</span><br><span class="line">    mOps.add(op);</span><br><span class="line">    op.enterAnim = mEnterAnim;</span><br><span class="line">    op.exitAnim = mExitAnim;</span><br><span class="line">    op.popEnterAnim = mPopEnterAnim;</span><br><span class="line">    op.popExitAnim = mPopExitAnim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 在这里就将setCustomAnimations方法传入的值给一个Op对象进行赋值并将它添加到一个list里备用。Op是定义在BackStackRecord类里的一个静态final类，BackStackRecord里有一个ArrayList管理这些对应的Op对象。</p>
<p>我们再来看下一步fragmentTransaction.commitAllowingStateLoss()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public int commitAllowingStateLoss() &#123;</span><br><span class="line">    return commitInternal(true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>跟踪到commitInternal方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">int commitInternal(boolean allowStateLoss) &#123;</span><br><span class="line">    if (mCommitted) throw new IllegalStateException(&quot;commit already called&quot;);</span><br><span class="line">    if (FragmentManagerImpl.DEBUG) &#123;</span><br><span class="line">        Log.v(TAG, &quot;Commit: &quot; + this);</span><br><span class="line">        LogWriter logw = new LogWriter(TAG);</span><br><span class="line">        PrintWriter pw = new PrintWriter(logw);</span><br><span class="line">        dump(&quot;  &quot;, null, pw, null);</span><br><span class="line">        pw.close();</span><br><span class="line">    &#125;</span><br><span class="line">    mCommitted = true;</span><br><span class="line">    if (mAddToBackStack) &#123;</span><br><span class="line">        mIndex = mManager.allocBackStackIndex(this);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        mIndex = -1;</span><br><span class="line">    &#125;</span><br><span class="line">    mManager.enqueueAction(this, allowStateLoss);</span><br><span class="line">    return mIndex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Fragemntmanager也是个抽象类，它的实现为FragmentManagerImpl类，进入源码跟踪可知<br>这个方法调用了fragemntmanager的enqueueAction(OpGenerator action, boolean allowStateLoss)方法，它的实现在FragmentManagerImpl 的 enqueueAction方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Adds an action to the queue of pending actions.</span><br><span class="line"> *</span><br><span class="line"> * @param action the action to add</span><br><span class="line"> * @param allowStateLoss whether to allow loss of state information</span><br><span class="line"> * @throws IllegalStateException if the activity has been destroyed</span><br><span class="line"> */</span><br><span class="line">public void enqueueAction(OpGenerator action, boolean allowStateLoss) &#123;</span><br><span class="line">    if (!allowStateLoss) &#123;</span><br><span class="line">        checkStateLoss();</span><br><span class="line">    &#125;</span><br><span class="line">    synchronized (this) &#123;</span><br><span class="line">        if (mDestroyed || mHost == null) &#123;</span><br><span class="line">            if (allowStateLoss) &#123;</span><br><span class="line">                // This FragmentManager isn&apos;t attached, so drop the entire transaction.</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            throw new IllegalStateException(&quot;Activity has been destroyed&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (mPendingActions == null) &#123;</span><br><span class="line">            mPendingActions = new ArrayList&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        mPendingActions.add(action);</span><br><span class="line">        scheduleCommit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到这方法中执行了一个scheduleCommit()方法,继续往下走进去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Schedules the execution when one hasn&apos;t been scheduled already. This should happen</span><br><span class="line"> * the first time &#123;@link #enqueueAction(OpGenerator, boolean)&#125; is called or when</span><br><span class="line"> * a postponed transaction has been started with</span><br><span class="line"> * &#123;@link Fragment#startPostponedEnterTransition()&#125;</span><br><span class="line"> */</span><br><span class="line">private void scheduleCommit() &#123;</span><br><span class="line">    synchronized (this) &#123;</span><br><span class="line">        boolean postponeReady =</span><br><span class="line">                mPostponedTransactions != null &amp;&amp; !mPostponedTransactions.isEmpty();</span><br><span class="line">        boolean pendingReady = mPendingActions != null &amp;&amp; mPendingActions.size() == 1;</span><br><span class="line">        if (postponeReady || pendingReady) &#123;</span><br><span class="line">            mHost.getHandler().removeCallbacks(mExecCommit);</span><br><span class="line">            mHost.getHandler().post(mExecCommit);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到这个方法里先remove掉主线程handler里已经存在的退出的动画任务 mExecCommit,<br>mExecCommit是个ruannable线程任务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Runnable mExecCommit = new Runnable() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        execPendingActions();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后在加入新的退出动画任务</p>
<p>这个任务里执行了execPendingActions()方法，我们继续往下走</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Only call from main thread!</span><br><span class="line"> */</span><br><span class="line">public boolean execPendingActions() &#123;</span><br><span class="line">    ensureExecReady(true);</span><br><span class="line"></span><br><span class="line">    boolean didSomething = false;</span><br><span class="line">    while (generateOpsForPendingActions(mTmpRecords, mTmpIsPop)) &#123;</span><br><span class="line">        mExecutingActions = true;</span><br><span class="line">        try &#123;</span><br><span class="line">            removeRedundantOperationsAndExecute(mTmpRecords, mTmpIsPop);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            cleanupExec();</span><br><span class="line">        &#125;</span><br><span class="line">        didSomething = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    doPendingDeferredStart();</span><br><span class="line">    burpActive();</span><br><span class="line"></span><br><span class="line">    return didSomething;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到这个方法里先执行了ensureExecReady(true)去执行前置的一些操作，然后在while循环里将挂起操作中的所有东西添加到记录, 以及它们是添加还是 pop 操作 isPop，是否需要操作等。然后进入<br>removeRedundantOperationsAndExecute(mTmpRecords, mTmpIsPop)方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Remove redundant BackStackRecord operations and executes them. This method merges operations</span><br><span class="line"> * of proximate records that allow reordering. See</span><br><span class="line"> * &#123;@link FragmentTransaction#setReorderingAllowed(boolean)&#125;.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * For example, a transaction that adds to the back stack and then another that pops that</span><br><span class="line"> * back stack record will be optimized to remove the unnecessary operation.</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * Likewise, two transactions committed that are executed at the same time will be optimized</span><br><span class="line"> * to remove the redundant operations as well as two pop operations executed together.</span><br><span class="line"> *</span><br><span class="line"> * @param records The records pending execution</span><br><span class="line"> * @param isRecordPop The direction that these records are being run.</span><br><span class="line"> */</span><br><span class="line">private void removeRedundantOperationsAndExecute(ArrayList&lt;BackStackRecord&gt; records,</span><br><span class="line">        ArrayList&lt;Boolean&gt; isRecordPop) &#123;</span><br><span class="line">    if (records == null || records.isEmpty()) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (isRecordPop == null || records.size() != isRecordPop.size()) &#123;</span><br><span class="line">        throw new IllegalStateException(&quot;Internal error with the back stack records&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Force start of any postponed transactions that interact with scheduled transactions:</span><br><span class="line">    executePostponedTransaction(records, isRecordPop);</span><br><span class="line"></span><br><span class="line">    final int numRecords = records.size();</span><br><span class="line">    int startIndex = 0;</span><br><span class="line">    for (int recordNum = 0; recordNum &lt; numRecords; recordNum++) &#123;</span><br><span class="line">        final boolean canReorder = records.get(recordNum).mReorderingAllowed;</span><br><span class="line">        if (!canReorder) &#123;</span><br><span class="line">            // execute all previous transactions</span><br><span class="line">            if (startIndex != recordNum) &#123;</span><br><span class="line">                executeOpsTogether(records, isRecordPop, startIndex, recordNum);</span><br><span class="line">            &#125;</span><br><span class="line">            // execute all pop operations that don&apos;t allow reordering together or</span><br><span class="line">            // one add operation</span><br><span class="line">            int reorderingEnd = recordNum + 1;</span><br><span class="line">            if (isRecordPop.get(recordNum)) &#123;</span><br><span class="line">                while (reorderingEnd &lt; numRecords</span><br><span class="line">                        &amp;&amp; isRecordPop.get(reorderingEnd)</span><br><span class="line">                        &amp;&amp; !records.get(reorderingEnd).mReorderingAllowed) &#123;</span><br><span class="line">                    reorderingEnd++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            executeOpsTogether(records, isRecordPop, recordNum, reorderingEnd);</span><br><span class="line">            startIndex = reorderingEnd;</span><br><span class="line">            recordNum = reorderingEnd - 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (startIndex != numRecords) &#123;</span><br><span class="line">        executeOpsTogether(records, isRecordPop, startIndex, numRecords);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这方法里，先执行executePostponedTransaction强制的将保存的Transactions除了当前的，其他的清除掉，然后循环取得BackStackRecord的list里的每一个对象来判断是否要执行executeOpsTogether操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Executes a subset of a list of BackStackRecords, all of which either allow reordering or</span><br><span class="line"> * do not allow ordering.</span><br><span class="line"> * @param records A list of BackStackRecords that are to be executed</span><br><span class="line"> * @param isRecordPop The direction that these records are being run.</span><br><span class="line"> * @param startIndex The index of the first record in &lt;code&gt;records&lt;/code&gt; to be executed</span><br><span class="line"> * @param endIndex One more than the final record index in &lt;code&gt;records&lt;/code&gt; to executed.</span><br><span class="line"> */</span><br><span class="line">private void executeOpsTogether(ArrayList&lt;BackStackRecord&gt; records,</span><br><span class="line">        ArrayList&lt;Boolean&gt; isRecordPop, int startIndex, int endIndex) &#123;</span><br><span class="line">    final boolean allowReordering = records.get(startIndex).mReorderingAllowed;</span><br><span class="line">    boolean addToBackStack = false;</span><br><span class="line">    if (mTmpAddedFragments == null) &#123;</span><br><span class="line">        mTmpAddedFragments = new ArrayList&lt;&gt;();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        mTmpAddedFragments.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    mTmpAddedFragments.addAll(mAdded);</span><br><span class="line">    Fragment oldPrimaryNav = getPrimaryNavigationFragment();</span><br><span class="line">    for (int recordNum = startIndex; recordNum &lt; endIndex; recordNum++) &#123;</span><br><span class="line">        final BackStackRecord record = records.get(recordNum);</span><br><span class="line">        final boolean isPop = isRecordPop.get(recordNum);</span><br><span class="line">        if (!isPop) &#123;</span><br><span class="line">            oldPrimaryNav = record.expandOps(mTmpAddedFragments, oldPrimaryNav);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            oldPrimaryNav = record.trackAddedFragmentsInPop(mTmpAddedFragments, oldPrimaryNav);</span><br><span class="line">        &#125;</span><br><span class="line">        addToBackStack = addToBackStack || record.mAddToBackStack;</span><br><span class="line">    &#125;</span><br><span class="line">    mTmpAddedFragments.clear();</span><br><span class="line"></span><br><span class="line">    if (!allowReordering) &#123;</span><br><span class="line">        FragmentTransition.startTransitions(this, records, isRecordPop, startIndex, endIndex,</span><br><span class="line">                false);</span><br><span class="line">    &#125;</span><br><span class="line">    executeOps(records, isRecordPop, startIndex, endIndex);</span><br><span class="line"></span><br><span class="line">    int postponeIndex = endIndex;</span><br><span class="line">    if (allowReordering) &#123;</span><br><span class="line">        ArraySet&lt;Fragment&gt; addedFragments = new ArraySet&lt;&gt;();</span><br><span class="line">        addAddedFragments(addedFragments);</span><br><span class="line">        postponeIndex = postponePostponableTransactions(records, isRecordPop,</span><br><span class="line">                startIndex, endIndex, addedFragments);</span><br><span class="line">        makeRemovedFragmentsInvisible(addedFragments);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (postponeIndex != startIndex &amp;&amp; allowReordering) &#123;</span><br><span class="line">        // need to run something now</span><br><span class="line">        FragmentTransition.startTransitions(this, records, isRecordPop, startIndex,</span><br><span class="line">                postponeIndex, true);</span><br><span class="line">        moveToState(mCurState, true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (int recordNum = startIndex; recordNum &lt; endIndex; recordNum++) &#123;</span><br><span class="line">        final BackStackRecord record = records.get(recordNum);</span><br><span class="line">        final boolean isPop = isRecordPop.get(recordNum);</span><br><span class="line">        if (isPop &amp;&amp; record.mIndex &gt;= 0) &#123;</span><br><span class="line">            freeBackStackIndex(record.mIndex);</span><br><span class="line">            record.mIndex = -1;</span><br><span class="line">        &#125;</span><br><span class="line">        record.runOnCommitRunnables();</span><br><span class="line">    &#125;</span><br><span class="line">    if (addToBackStack) &#123;</span><br><span class="line">        reportBackStackChanged();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在这个方法里也循环的去取得每一个FragmentTransaction对应操作集的是否是执行出栈分别跳转到对应的方法中执行<figure class="highlight plain"><figcaption><span>(!isPop) &#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    oldPrimaryNav = record.expandOps(mTmpAddedFragments, oldPrimaryNav);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    oldPrimaryNav = record.trackAddedFragmentsInPop(mTmpAddedFragments, oldPrimaryNav);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在这些方法中都有大致相同的逻辑，判断Op对象里的对应的状态值进行add，hide，remove等操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">switch (op.cmd) &#123;</span><br><span class="line">    case OP_ADD:</span><br><span class="line">    case OP_ATTACH:</span><br><span class="line">        added.add(op.fragment);</span><br><span class="line">        break;</span><br><span class="line">    case OP_REMOVE:</span><br><span class="line">    case OP_DETACH: &#123;</span><br><span class="line">        added.remove(op.fragment);</span><br><span class="line">        if (op.fragment == oldPrimaryNav) &#123;</span><br><span class="line">            mOps.add(opNum, new Op(OP_UNSET_PRIMARY_NAV, op.fragment));</span><br><span class="line">            opNum++;</span><br><span class="line">            oldPrimaryNav = null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    break;</span><br><span class="line">    </span><br><span class="line">    。。。</span><br></pre></td></tr></table></figure>
<p>将各种操作封装成Op并添加，最后在executePopOps方法中通过循环给每个fragment调用setNextAnim设置动画属性。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">void executePopOps(boolean moveToState) &#123;</span><br><span class="line">    for (int opNum = mOps.size() - 1; opNum &gt;= 0; opNum--) &#123;</span><br><span class="line">        final Op op = mOps.get(opNum);</span><br><span class="line">        Fragment f = op.fragment;</span><br><span class="line">        if (f != null) &#123;</span><br><span class="line">            f.setNextTransition(FragmentManagerImpl.reverseTransit(mTransition),</span><br><span class="line">                    mTransitionStyle);</span><br><span class="line">        &#125;</span><br><span class="line">        switch (op.cmd) &#123;</span><br><span class="line">            case OP_ADD:</span><br><span class="line">                f.setNextAnim(op.popExitAnim);</span><br><span class="line">                mManager.removeFragment(f);</span><br><span class="line">                break;</span><br><span class="line">            case OP_REMOVE:</span><br><span class="line">                f.setNextAnim(op.popEnterAnim);</span><br><span class="line">                mManager.addFragment(f, false);</span><br><span class="line">                break;</span><br><span class="line">            case OP_HIDE:</span><br><span class="line">                f.setNextAnim(op.popEnterAnim);</span><br><span class="line">                mManager.showFragment(f);</span><br><span class="line">                break;</span><br><span class="line">            case OP_SHOW:</span><br><span class="line">                f.setNextAnim(op.popExitAnim);</span><br><span class="line">                mManager.hideFragment(f);</span><br><span class="line">                break;</span><br><span class="line">            case OP_DETACH:</span><br><span class="line">                f.setNextAnim(op.popEnterAnim);</span><br><span class="line">                mManager.attachFragment(f);</span><br><span class="line">                break;</span><br><span class="line">            case OP_ATTACH:</span><br><span class="line">                f.setNextAnim(op.popExitAnim);</span><br><span class="line">                mManager.detachFragment(f);</span><br><span class="line">                break;</span><br><span class="line">            case OP_SET_PRIMARY_NAV:</span><br><span class="line">                mManager.setPrimaryNavigationFragment(null);</span><br><span class="line">                break;</span><br><span class="line">            case OP_UNSET_PRIMARY_NAV:</span><br><span class="line">                mManager.setPrimaryNavigationFragment(f);</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                throw new IllegalArgumentException(&quot;Unknown cmd: &quot; + op.cmd);</span><br><span class="line">        &#125;</span><br><span class="line">        if (!mReorderingAllowed &amp;&amp; op.cmd != OP_REMOVE &amp;&amp; f != null) &#123;</span><br><span class="line">            mManager.moveFragmentToExpectedState(f);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!mReorderingAllowed &amp;&amp; moveToState) &#123;</span><br><span class="line">        mManager.moveToState(mManager.mCurState, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当fragmentmanager在moveToState或者completeShowHideFragment等操作时，都会去调用getNextAnim方法获得动画对象，或者通过loadAnimation方法去间接调用getNextAnim方法获得动画对象，最终在后续操作中完成动画的执行。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/qinlingrong.github.io/2017/03/17/初探Fragment/" rel="next" title="">
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/qinlingrong.github.io/2018/02/27/android屏幕解锁新解/" rel="prev" title="">
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/qinlingrong.github.io/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/qinlingrong.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/qinlingrong.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/qinlingrong.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/qinlingrong.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/qinlingrong.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/qinlingrong.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/qinlingrong.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/qinlingrong.github.io/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/qinlingrong.github.io/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/qinlingrong.github.io/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/qinlingrong.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
